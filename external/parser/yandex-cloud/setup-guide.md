# Развертывание на Яндекс.Облаке

## Архитектура системы

```
┌─────────────────────────────────────────────────────────┐
│                  Яндекс.Облако                          │
│                                                         │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Главный сервер (2 vCPU, 4GB RAM)               │  │
│  │  - Traefik (балансировщик)                       │  │
│  │  - API сервер (Node.js)                          │  │
│  │  - PostgreSQL                                     │  │
│  │  - Redis                                          │  │
│  │  - Админка                                        │  │
│  │  IP: 51.250.X.X                                   │  │
│  └──────────────────────────────────────────────────┘  │
│                         │                               │
│                         │ (балансировка)                │
│                         ▼                               │
│  ┌─────────────────────────────────────────────────┐   │
│  │  Парсер-ноды (по 1 vCPU, 2GB RAM)              │   │
│  │                                                  │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐      │   │
│  │  │ Нода #1  │  │ Нода #2  │  │ Нода #3  │      │   │
│  │  │ IP: .1   │  │ IP: .2   │  │ IP: .3   │      │   │
│  │  └──────────┘  └──────────┘  └──────────┘      │   │
│  │                                                  │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐      │   │
│  │  │ Нода #4  │  │ Нода #5  │  │ Нода #6  │      │   │
│  │  │ IP: .4   │  │ IP: .5   │  │ IP: .6   │      │   │
│  │  └──────────┘  └──────────┘  └──────────┘      │   │
│  │                                                  │   │
│  │  ┌──────────┐  ┌──────────┐                     │   │
│  │  │ Нода #7  │  │ Нода #8  │                     │   │
│  │  │ IP: .7   │  │ IP: .8   │                     │   │
│  │  └──────────┘  └──────────┘                     │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
                         │
                         ▼
              ┌──────────────────┐
              │  Telegram Bot    │
              │  (уведомления)   │
              └──────────────────┘
```

## Как работает система

### 1. Клиент добавляет ссылку на парсинг
```
Клиент → Telegram Bot → API сервер → Балансировщик → Парсер-нода
```

### 2. Распределение нагрузки
- Traefik автоматически выбирает свободную ноду
- Каждый клиент "прикрепляется" к своей ноде (sticky session)
- Если нода упала - запросы идут на другую

### 3. Парсинг Авито
```javascript
// Каждая нода работает независимо:
Нода #1 (IP: 51.250.1.1) → Авито видит пользователя из Москвы
Нода #2 (IP: 51.250.1.2) → Авито видит другого пользователя
Нода #3 (IP: 51.250.1.3) → Авито видит третьего пользователя
// И так далее...
```

### 4. Отправка результатов
```
Парсер-нода → API сервер → Telegram Bot → Клиент
```

## Стоимость на Яндекс.Облаке

### Главный сервер
- 2 vCPU, 4GB RAM, 20GB SSD
- ~2,000₽/месяц

### 8 парсер-нод
- 1 vCPU, 2GB RAM, 10GB SSD каждая
- 1,151₽ × 8 = 9,208₽/месяц

### Итого: 11,208₽/месяц

## Производительность

### Одна нода:
- 1-2 запроса в секунду
- Обслуживает 15-20 клиентов

### 8 нод:
- 8-16 запросов в секунду
- Обслуживает 150+ клиентов

### Масштабирование:
- Нужно больше клиентов? Добавляем ноды
- 1 новая нода = +20 клиентов = +35,000₽ дохода
- Стоимость ноды = 1,151₽

## Преимущества архитектуры

### 1. Каждая нода = уникальный IP
- Авито не может связать запросы между нодами
- Каждая нода выглядит как отдельный пользователь

### 2. Отказоустойчивость
- Если 2-3 ноды упали → система работает
- Traefik автоматически перенаправляет трафик

### 3. Легкое масштабирование
- Добавить ноду = 5 минут
- Удалить ноду = 1 команда

### 4. Мониторинг
- Видим статус каждой ноды в реальном времени
- Алерты в Telegram при проблемах

## Экономика

### Доходы (150 клиентов):
- 100 базовых × 1,750₽ = 175,000₽
- 50 премиум × 6,000₽ = 300,000₽
- **Итого: 475,000₽/месяц**

### Расходы:
- Яндекс.Облако: 11,208₽/месяц
- **Прибыль: 463,792₽/месяц**

### ROI: 4,140%